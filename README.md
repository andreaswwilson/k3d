# k3d Local Development Environment

Local Kubernetes development environment using k3d, with an ASP.NET Core backend, Nginx frontend, and PostgreSQL database.

## Prerequisites

- [Docker](https://docs.docker.com/get-docker/)
- [k3d](https://k3d.io/)
- [kubectl](https://kubernetes.io/docs/tasks/tools/)
- [mkcert](https://github.com/FiloSottile/mkcert)
- [OpenTofu](https://opentofu.org/)
- [Ansible](https://docs.ansible.com/)
- [.NET 10 SDK](https://dotnet.microsoft.com/download)

## Full Deploy (from scratch)

Creates the k3d cluster, generates TLS certs, builds all images, deploys everything, and configures `/etc/hosts`:

```bash
make deploy
```

## Full Destroy

Tears down all OpenTofu resources, deletes the k3d cluster, and cleans up `/etc/hosts`:

```bash
make destroy
```

## OpenTofu Only

Apply or destroy the Kubernetes resources (namespaces, secrets, manifests) without touching the cluster itself:

```bash
make tofu-apply
make tofu-destroy
```

## Rebuild Frontend

Build the frontend Docker image, import it into k3d, and restart the deployment:

```bash
make rebuild-frontend
```

## Rebuild Backend

Build the backend Docker image (runs unit tests as part of the build), import it into k3d, and restart the deployment:

```bash
make rebuild-backend
```

## Rebuild Everything

Rebuild and redeploy both frontend and backend:

```bash
make rebuild
```

## Run All Tests

```bash
make test
```

## Run Backend Tests Only

Run backend tests locally, including integration tests that use Testcontainers with PostgreSQL 18:

```bash
make test-backend
```

## Project Structure

```
├── Makefile                  # Build and deployment targets
├── ansible/                  # Ansible playbooks for setup/teardown
├── backend/                  # ASP.NET Core 10 Web API (C# 14)
│   ├── Dockerfile            # Multi-stage: build → test → publish → runtime
│   ├── src/Backend.Api/      # API project
│   └── tests/Backend.Tests/  # xUnit + Testcontainers tests
├── certs/                    # TLS certificates (generated by mkcert)
├── frontend/                 # Nginx + static HTML frontend
├── manifests/                # Kubernetes YAML manifests
└── tofu/                     # OpenTofu infrastructure config
```
